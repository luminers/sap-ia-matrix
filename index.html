<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Impacto IA en Desarrollo SAP ‚Äì Vue Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        :root {
            --bg: #0d1117;
            --bg-card: #161b22;
            --bg-head: #1c2333;
            --border: #30363d;
            --txt: #e6edf3;
            --muted: #8b949e;
            --blue: #58a6ff;
            --green: #3fb950;
            --yellow: #e3b341;
            --orange: #f0883e;
            --red: #f85149;
            --purple: #bc8cff;
            --hover-row: rgba(88, 166, 255, .1);
            --t-abap: #f0883e;
            --t-odata: #58a6ff;
            --t-cap: #bc8cff;
            --t-fiori: #3fb950;
            --t-mixed: #e3b341;
        }



        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--txt);
            min-height: 100vh;
            padding: 2rem;
            position: relative;
        }

        [v-cloak] {
            display: none;
        }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header .eyebrow {
            font-size: .72rem;
            font-weight: 700;
            letter-spacing: .14em;
            text-transform: uppercase;
            color: var(--blue);
            margin-bottom: .45rem;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #e6edf3 25%, #58a6ff 80%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: .35rem;
        }

        .header p {
            color: var(--muted);
            font-size: .875rem;
        }

        /* ‚îÄ‚îÄ SUMMARY CARDS ‚îÄ‚îÄ */
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(155px, 1fr));
            gap: .85rem;
            margin-bottom: 1.8rem;
        }

        .sc {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem 1.2rem;
            transition: border-color .2s;
        }

        .sc:hover {
            border-color: var(--blue);
        }

        .sc .label {
            font-size: .68rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: .08em;
            color: var(--muted);
            margin-bottom: .3rem;
        }

        .sc .value {
            font-size: 1.55rem;
            font-weight: 800;
        }

        .sc .sub {
            font-size: .7rem;
            color: var(--muted);
            margin-top: .15rem;
        }

        .val-green {
            color: var(--green);
        }

        .val-blue {
            color: var(--blue);
        }

        .val-yellow {
            color: var(--yellow);
        }

        .val-purple {
            color: var(--purple);
        }

        /* ‚îÄ‚îÄ LEGEND ‚îÄ‚îÄ */
        .legend {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 1.4rem;
        }

        .leg-item {
            display: flex;
            align-items: center;
            gap: .4rem;
            font-size: .75rem;
            color: var(--muted);
            cursor: default;
        }

        .leg-dot {
            width: 9px;
            height: 9px;
            border-radius: 50%;
        }

        /* ‚îÄ‚îÄ ACTIONS BAR ‚îÄ‚îÄ */
        .actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: .9rem;
            gap: .75rem;
            flex-wrap: wrap;
        }

        .edit-hint {
            font-size: .7rem;
            color: var(--muted);
            background: rgba(88, 166, 255, .06);
            border: 1px solid var(--border);
            border-radius: 5px;
            padding: .25rem .7rem;
        }

        .btn-group {
            display: flex;
            gap: .6rem;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: .4rem;
            padding: .42rem 1rem;
            border-radius: 6px;
            font-size: .8rem;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--txt);
            transition: all .18s;
            font-family: inherit;
        }

        .btn:hover {
            background: var(--bg-head);
            border-color: var(--blue);
            color: var(--blue);
        }

        .btn-primary {
            background: var(--blue);
            color: #0d1117;
            border-color: var(--blue);
        }

        .btn-primary:hover {
            background: #79b8ff;
            border-color: #79b8ff;
            color: #0d1117;
        }

        .btn-success {
            border-color: var(--green);
            color: var(--green);
        }

        .btn-success:hover {
            background: rgba(63, 185, 80, .1);
        }

        /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
        .table-wrap {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 40px rgba(0, 0, 0, .5);
            background: var(--bg-card);
        }

        table {
            border-collapse: collapse;
            width: 100%;
            min-width: 1100px;
        }

        thead th {
            background: var(--bg-head);
            color: var(--muted);
            font-size: .67rem;
            font-weight: 700;
            letter-spacing: .07em;
            text-transform: uppercase;
            padding: .85rem .9rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 2;
        }

        thead th.num {
            text-align: center;
        }

        thead th.th-act {
            width: 80px;
            text-align: center;
        }

        .gr td {
            background: rgba(88, 166, 255, .06);
            color: var(--blue);
            font-size: .7rem;
            font-weight: 700;
            letter-spacing: .08em;
            text-transform: uppercase;
            padding: .45rem 1rem;
            border-top: 1px solid rgba(88, 166, 255, .18);
            border-bottom: 1px solid rgba(88, 166, 255, .18);
        }

        .gr .gr-name {
            outline: none;
            cursor: text;
            min-width: 200px;
            display: inline-block;
        }

        .gr .gr-actions {
            float: right;
            display: flex;
            gap: .4rem;
            padding-right: .5rem;
        }

        .gr .gr-btn {
            background: rgba(88, 166, 255, .12);
            border: 1px solid rgba(88, 166, 255, .25);
            border-radius: 5px;
            color: var(--blue);
            font-size: .65rem;
            font-weight: 700;
            cursor: pointer;
            padding: .15rem .5rem;
            transition: all .15s;
            font-family: inherit;
        }

        .gr .gr-btn:hover {
            background: rgba(88, 166, 255, .25);
        }

        .gr .gr-btn.del-gr {
            background: rgba(248, 81, 73, .1);
            border-color: rgba(248, 81, 73, .25);
            color: var(--red);
        }

        tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background .12s;
        }

        tbody tr:not(.gr):hover {
            background: var(--hover-row);
        }

        td {
            padding: .78rem .9rem;
            font-size: .8rem;
            line-height: 1.45;
            color: var(--txt);
            vertical-align: middle;
        }

        td.num {
            text-align: center;
            color: var(--muted);
            font-size: .75rem;
        }

        td[contenteditable="true"] {
            outline: none;
            cursor: text;
        }

        td[contenteditable="true"]:hover {
            background: rgba(88, 166, 255, .07);
        }

        td[contenteditable="true"]:focus {
            background: rgba(88, 166, 255, .12);
            box-shadow: inset 0 0 0 2px rgba(88, 166, 255, .45);
            border-radius: 3px;
        }

        .tech {
            display: inline-block;
            padding: .15rem .5rem;
            border-radius: 20px;
            font-size: .68rem;
            font-weight: 700;
            letter-spacing: .03em;
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
        }

        .t-abap {
            background: rgba(240, 136, 62, .15);
            color: var(--t-abap);
        }

        .t-odata {
            background: rgba(88, 166, 255, .15);
            color: var(--t-odata);
        }

        .t-cap {
            background: rgba(188, 140, 255, .15);
            color: var(--t-cap);
        }

        .t-fiori {
            background: rgba(63, 185, 80, .15);
            color: var(--t-fiori);
        }

        .t-mixed {
            background: rgba(227, 179, 65, .15);
            color: var(--t-mixed);
        }

        .time-before {
            color: var(--orange);
            font-weight: 600;
        }

        .time-after {
            color: var(--green);
            font-weight: 600;
        }

        .pbar-wrap {
            display: flex;
            align-items: center;
            gap: .5rem;
            min-width: 110px;
        }

        .pbar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, .07);
            border-radius: 99px;
            overflow: hidden;
        }

        .pbar-fill {
            height: 100%;
            border-radius: 99px;
            transition: width .4s ease;
        }

        .pbar-val {
            font-size: .76rem;
            font-weight: 700;
            min-width: 36px;
            text-align: right;
        }

        .tier-low .pbar-fill {
            background: var(--yellow);
        }

        .tier-low .pbar-val {
            color: var(--yellow);
        }

        .tier-mid .pbar-fill {
            background: var(--orange);
        }

        .tier-mid .pbar-val {
            color: var(--orange);
        }

        .tier-high .pbar-fill {
            background: var(--green);
        }

        .tier-high .pbar-val {
            color: var(--green);
        }

        .tier-xhigh .pbar-fill {
            background: var(--blue);
        }

        .tier-xhigh .pbar-val {
            color: var(--blue);
        }

        .row-del {
            background: none;
            border: 1px solid transparent;
            border-radius: 5px;
            color: var(--muted);
            font-size: .85rem;
            cursor: pointer;
            padding: .2rem .4rem;
            line-height: 1;
        }

        .row-del:hover {
            background: rgba(248, 81, 73, .12);
            border-color: rgba(248, 81, 73, .3);
            color: var(--red);
        }

        .add-row-bar {
            display: flex;
            justify-content: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-card);
            border-top: 1px dashed var(--border);
            border-radius: 0 0 12px 12px;
            flex-wrap: wrap;
        }

        .add-row-bar span {
            font-size: .75rem;
            color: var(--muted);
            display: flex;
            align-items: center;
        }

        @page {
            size: A4 landscape;
            margin: 1cm 1.2cm;
        }

        @media print {
            body {
                background: #fff !important;
                color: #000 !important;
                padding: 0 !important;
            }

            .actions,
            .add-row-bar,
            .td-act,
            .th-act,
            .gr-actions,
            #balatro-bg {
                display: none !important;
            }

            .table-wrap {
                backdrop-filter: none !important;
                background: #fff !important;
                box-shadow: none !important;
            }

            table {
                width: 100% !important;
                border: 1px solid #ccc;
            }

            th,
            td {
                border: 1px solid #eee;
            }
        }
    </style>
</head>

<body>


    <div id="app" v-cloak>
        <header class="header">
            <div class="eyebrow">Medici√≥n de Impacto ¬∑ herramiente IA en SAP (Vue Version)</div>
            <h1>‚ö° Desarrollo SAP ‚Äî Antes vs Despu√©s de IA</h1>
            <p>Comparativa de tiempos reales con persistencia de datos local</p>
        </header>

        <!-- SUMMARY -->
        <div class="summary">
            <div class="sc">
                <div class="label">Tareas medidas</div>
                <div class="value val-blue">{{ metrics.count }}</div>
                <div class="sub">Casos comparados</div>
            </div>
            <div class="sc">
                <div class="label">Tiempo total SIN IA</div>
                <div class="value val-yellow">{{ formatH(metrics.totalBefore) }}</div>
                <div class="sub">Horas acumuladas</div>
            </div>
            <div class="sc">
                <div class="label">Tiempo total CON IA</div>
                <div class="value val-green">{{ formatH(metrics.totalAfter) }}</div>
                <div class="sub">Horas acumuladas</div>
            </div>
            <div class="sc">
                <div class="label">Ahorro total</div>
                <div class="value val-green">{{ formatH(metrics.totalSaved) }}</div>
                <div class="sub">Horas recuperadas</div>
            </div>
            <div class="sc">
                <div class="label">Mejora promedio</div>
                <div class="value val-purple">{{ metrics.avgPct }}%</div>
                <div class="sub">Reducci√≥n de tiempo</div>
            </div>
        </div>

        <div class="legend">
            <div v-for="t in TECHS" :key="t.label" class="leg-item">
                <span class="leg-dot" :style="{ background: 'var(--' + t.cls + ')' }"></span>{{ t.label }}
            </div>
            <div class="leg-item" style="font-style:italic; font-size:.68rem;">¬∑ Clic en el badge de tecnolog√≠a para
                cambiarla</div>
        </div>

        <div class="actions">
            <div class="edit-hint">‚úèÔ∏è Los cambios se guardan autom√°ticamente en tu navegador</div>
            <div class="btn-group">
                <button class="btn btn-success" @click="addSection">Ôºã Agregar secci√≥n</button>
                <button class="btn" @click="exportPDF">üìÑ Exportar PDF</button>
                <button class="btn btn-primary" @click="exportCSV">‚¨áÔ∏è Descargar CSV</button>
                <button class="btn btn-danger" @click="resetData" style="font-size: 0.7rem; opacity: 0.7;">üóë Limpiar
                    todo</button>
            </div>
        </div>

        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th class="num">#</th>
                        <th>Tarea de Desarrollo</th>
                        <th>Tecnolog√≠a</th>
                        <th>Descripci√≥n / Alcance</th>
                        <th>Tiempo SIN IA</th>
                        <th>Tiempo CON IA</th>
                        <th>Ahorro</th>
                        <th>Mejora %</th>
                        <th>Observaciones</th>
                        <th class="th-act">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <template v-for="(section, sIdx) in sections" :key="section.id">
                        <tr class="gr">
                            <td colspan="10">
                                <span class="gr-name" contenteditable="true"
                                    @blur="section.name = $event.target.innerText">{{ section.name }}</span>
                                <div class="gr-actions">
                                    <button class="gr-btn" @click="addRow(sIdx)">Ôºã Fila</button>
                                    <button class="gr-btn del-gr" @click="removeSection(sIdx)">‚úï Secci√≥n</button>
                                </div>
                            </td>
                        </tr>
                        <tr v-for="(row, rIdx) in section.rows" :key="row.id">
                            <td class="num" contenteditable="true" @blur="row.num = $event.target.innerText">{{ row.num
                                }}</td>
                            <td contenteditable="true" @blur="row.task = $event.target.innerText">{{ row.task }}</td>
                            <td class="td-tech">
                                <span :class="['tech', getTech(row.tech).cls]" @click="cycleTech(row)">{{ row.tech
                                    }}</span>
                            </td>
                            <td contenteditable="true" @blur="row.scope = $event.target.innerText">{{ row.scope }}</td>
                            <td class="time-before" contenteditable="true"
                                @blur="updateTime(row, 'before', $event.target.innerText)">
                                {{ formatH(row.before) }}
                            </td>
                            <td class="time-after" contenteditable="true"
                                @blur="updateTime(row, 'after', $event.target.innerText)">
                                {{ formatH(row.after) }}
                            </td>
                            <td :style="{ color: (row.before - row.after) > 0 ? 'var(--green)' : 'var(--red)' }">
                                {{ formatH(Math.max(0, row.before - row.after)) }}
                            </td>
                            <td>
                                <div :class="['pbar-wrap', getTier(calculatePct(row.before, row.after))]">
                                    <div class="pbar">
                                        <div class="pbar-fill"
                                            :style="{ width: Math.max(0, Math.min(100, calculatePct(row.before, row.after))) + '%' }">
                                        </div>
                                    </div>
                                    <span class="pbar-val">{{ calculatePct(row.before, row.after) }}%</span>
                                </div>
                            </td>
                            <td contenteditable="true" @blur="row.obs = $event.target.innerText">{{ row.obs }}</td>
                            <td class="td-act">
                                <button class="row-del" @click="removeRow(sIdx, rIdx)">üóë</button>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>

            <div class="add-row-bar">
                <span>Agregar fila en:</span>
                <button v-for="(s, idx) in sections" :key="s.id" class="btn btn-success"
                    style="font-size: .72rem; padding: .3rem .7rem;" @click="addRow(idx)">
                    Ôºã {{ s.name.replace(/^[^\w]+/, '').slice(0, 20) }}
                </button>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, watch, onMounted } = Vue;

        const TECHS = [
            { cls: 't-abap', label: 'ABAP' },
            { cls: 't-odata', label: 'OData' },
            { cls: 't-cap', label: 'CAP' },
            { cls: 't-fiori', label: 'Fiori' },
            { cls: 't-mixed', label: 'Multi' }
        ];

        const DEFAULT_DATA = [
            {
                id: 1, name: 'üì¶ ABAP ‚Äî Reportes & L√≥gica de Negocio',
                rows: [
                    { id: 101, num: '1', task: 'Reporte ALV cl√°sico (SELECT + LOOP)', tech: 'ABAP', scope: 'Reporte de ventas con filtros, totales y layout ALV', before: 6, after: 2, obs: 'IA gener√≥ estructura base + SELECTs optimizados' },
                    { id: 102, num: '2', task: 'Enhancement de funci√≥n est√°ndar', tech: 'ABAP', scope: 'Localizar enhancement spot + implementar l√≥gica custom', before: 5, after: 1.5, obs: 'IA identific√≥ el exit correcto y gener√≥ el c√≥digo' },
                    { id: 103, num: '3', task: 'BAPI Wrapper / Function Module custom', tech: 'ABAP', scope: 'Wrapper sobre BAPI est√°ndar con validaciones', before: 4, after: 1, obs: 'IA gener√≥ interface + manejo de RETURN completo' },
                    { id: 104, num: '4', task: 'Debugging y performance', tech: 'ABAP', scope: 'Identificar SELECTs ineficientes + refactorizar', before: 8, after: 2, obs: 'IA analiz√≥ trace y propuso refactorizaci√≥n' },
                    { id: 105, num: '5', task: 'Smartform / Adobe Form', tech: 'ABAP', scope: 'Formulario de impresi√≥n con logo y tabla', before: 10, after: 4, obs: 'IA gener√≥ driver program y estructura' }
                ]
            },
            {
                id: 2, name: 'üåê OData ‚Äî Servicios REST para SAP',
                rows: [
                    { id: 201, num: '6', task: 'Servicio OData SEGW (GET_ENTITYSET)', tech: 'OData', scope: 'Entity set con filtros y paginaci√≥n desde tabla custom', before: 8, after: 2.5, obs: 'IA gener√≥ clase MPC, DPC y m√©todo completo' },
                    { id: 202, num: '7', task: 'OData CREATE / UPDATE / DELETE', tech: 'OData', scope: 'CRUD completo sobre entidad con validaciones', before: 10, after: 3, obs: 'IA gener√≥ los 3 m√©todos con manejo de errores' },
                    { id: 203, num: '8', task: 'CDS View + OData autom√°tico', tech: 'OData', scope: 'Vista CDS con @OData.publish y filtros', before: 6, after: 1.5, obs: 'IA gener√≥ CDS + anotaciones @Search' }
                ]
            },
            {
                id: 3, name: '‚òÅÔ∏è CAP ‚Äî Cloud Application Programming',
                rows: [
                    { id: 301, num: '9', task: 'Modelo CDS + Service CAP b√°sico', tech: 'CAP', scope: 'Entidades, asociaciones y servicio expuesto', before: 8, after: 2, obs: 'IA gener√≥ schema.cds + srv completo' },
                    { id: 302, num: '10', task: 'CAP con handlers custom (JS)', tech: 'CAP', scope: 'L√≥gica before/after, validaciones y c√°lculos', before: 10, after: 3, obs: 'IA gener√≥ handlers con async/await' },
                    { id: 303, num: '11', task: 'CAP + integraci√≥n S/4 HANA', tech: 'CAP', scope: 'Consumo de API est√°ndar SAP con destinations', before: 14, after: 5, obs: 'IA gener√≥ external service + config' }
                ]
            },
            {
                id: 4, name: 'üñ•Ô∏è Fiori ‚Äî Apps & UI5',
                rows: [
                    { id: 401, num: '12', task: 'Fiori Elements ‚Äì List Report', tech: 'Fiori', scope: 'App ListReport con filtros y navegaci√≥n', before: 8, after: 2, obs: 'IA gener√≥ @UI.lineItem + @SelectionField' },
                    { id: 402, num: '13', task: 'Fiori Elements ‚Äì Object Page', tech: 'Fiori', scope: 'Detalle con secciones, subsecciones y tabs', before: 10, after: 3, obs: 'IA gener√≥ @UI.facets + FieldGroup' },
                    { id: 403, num: '14', task: 'SAPUI5 Custom App (freestyle)', tech: 'Fiori', scope: 'App custom con OData binding y routing', before: 20, after: 8, obs: 'IA gener√≥ controller, views XML y bindings' }
                ]
            }
        ];

        createApp({
            setup() {
                const sections = ref([]);
                const STORAGE_KEY = 'sap_ia_impact_v1';

                const loadData = () => {
                    const saved = localStorage.getItem(STORAGE_KEY);
                    if (saved) {
                        try {
                            sections.value = JSON.parse(saved);
                        } catch (e) {
                            sections.value = JSON.parse(JSON.stringify(DEFAULT_DATA));
                        }
                    } else {
                        sections.value = JSON.parse(JSON.stringify(DEFAULT_DATA));
                    }
                };

                onMounted(() => {
                    loadData();
                });

                watch(sections, (newVal) => {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(newVal));
                }, { deep: true });

                const metrics = computed(() => {
                    let totalBefore = 0, totalAfter = 0, pcts = [], count = 0;
                    sections.value.forEach(s => {
                        s.rows.forEach(r => {
                            if (r.before > 0) {
                                totalBefore += r.before;
                                totalAfter += r.after;
                                pcts.push(((r.before - r.after) / r.before) * 100);
                                count++;
                            }
                        });
                    });
                    const totalSaved = totalBefore - totalAfter;
                    const avgPct = pcts.length ? Math.round(pcts.reduce((a, b) => a + b, 0) / pcts.length) : 0;
                    return { count, totalBefore, totalAfter, totalSaved, avgPct };
                });

                const parseH = (text) => {
                    const t = (text || '').toString().trim().toLowerCase();
                    const minMatch = t.match(/(\d+(?:[.,]\d+)?)\s*min/);
                    if (minMatch) return parseFloat(minMatch[1].replace(',', '.')) / 60;
                    const hMatch = t.match(/(\d+(?:[.,]\d+)?)/);
                    return hMatch ? parseFloat(hMatch[1].replace(',', '.')) : 0;
                };

                const formatH = (h) => {
                    if (h === 0 || isNaN(h)) return '‚Äî';
                    if (h < 1) return Math.round(h * 60) + ' min';
                    const int = Math.floor(h), dec = h - int;
                    return int + (dec > 0.05 ? '.' + Math.round(dec * 10) : '') + ' h';
                };

                const updateTime = (row, field, val) => {
                    row[field] = parseH(val);
                };

                const calculatePct = (b, a) => {
                    if (!b || b <= 0) return 0;
                    return Math.round(((b - a) / b) * 100);
                };

                const getTier = (pct) => {
                    if (pct >= 70) return 'tier-xhigh';
                    if (pct >= 50) return 'tier-high';
                    if (pct >= 30) return 'tier-mid';
                    return 'tier-low';
                };

                const getTech = (label) => TECHS.find(t => t.label === label) || TECHS[0];

                const cycleTech = (row) => {
                    const idx = TECHS.findIndex(t => t.label === row.tech);
                    row.tech = TECHS[(idx + 1) % TECHS.length].label;
                };

                const addRow = (sIdx) => {
                    sections.value[sIdx].rows.push({
                        id: Date.now(),
                        num: sections.value[sIdx].rows.length + 1,
                        task: 'Nueva tarea',
                        tech: 'ABAP',
                        scope: 'Descripci√≥n...',
                        before: 0,
                        after: 0,
                        obs: '‚Äî'
                    });
                };

                const removeRow = (sIdx, rIdx) => {
                    sections.value[sIdx].rows.splice(rIdx, 1);
                };

                const addSection = () => {
                    const name = prompt('Nombre de la secci√≥n:', 'Nueva Secci√≥n');
                    if (name) {
                        sections.value.push({ id: Date.now(), name, rows: [] });
                        addRow(sections.value.length - 1);
                    }
                };

                const removeSection = (sIdx) => {
                    if (confirm('¬øEliminar toda la secci√≥n?')) {
                        sections.value.splice(sIdx, 1);
                    }
                };

                const resetData = () => {
                    if (confirm('¬øSeguro que quieres borrar todos los datos locales?')) {
                        sections.value = JSON.parse(JSON.stringify(DEFAULT_DATA));
                    }
                };

                const exportPDF = () => window.print();

                const exportCSV = () => {
                    const headers = ['Secci√≥n', '#', 'Tarea', 'Tecnolog√≠a', 'Alcance', 'SIN IA (h)', 'CON IA (h)', 'Ahorro (h)', 'Mejora %', 'Observaciones'];
                    const rows = [];
                    sections.value.forEach(s => {
                        s.rows.forEach(r => {
                            rows.push([
                                s.name, r.num, r.task, r.tech, r.scope, r.before, r.after,
                                Math.max(0, r.before - r.after), calculatePct(r.before, r.after), r.obs
                            ]);
                        });
                    });
                    const csv = [headers, ...rows].map(row => row.map(v => `"${String(v).replace(/"/g, '""')}"`).join(',')).join('\n');
                    const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'Impacto_IA_SAP_Vue.csv';
                    a.click();
                    URL.revokeObjectURL(url);
                };

                return {
                    sections, metrics, TECHS, formatH, updateTime, calculatePct, getTier, getTech, cycleTech,
                    addRow, removeRow, addSection, removeSection, resetData, exportPDF, exportCSV
                };
            }
        }).mount('#app');
    </script>


</body>

</html>